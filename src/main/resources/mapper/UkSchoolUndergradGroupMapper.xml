<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.study.service.matching.rules.UkSchoolUndergradGroupMapper">

    <select id="findGroupCode" resultType="string">
        SELECT group_code
        FROM uk_school_undergrad_group
        WHERE target_school_id = #{targetSchoolId}
          AND undergrad_school_id = #{undergradSchoolId}
          AND (effective_from IS NULL OR effective_from &lt;= NOW())
          AND (effective_to IS NULL OR effective_to &gt; NOW())
        ORDER BY
            COALESCE(priority, 0) DESC,
            COALESCE(effective_from, '1970-01-01') DESC,
            id DESC
        LIMIT 1
    </select>

</mapper>

