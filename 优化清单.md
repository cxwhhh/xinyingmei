# 优化清单

本清单用于把项目的高风险点与可落地的优化项，按优先级拆分为可执行任务；每条尽量包含“现状/建议/收益/工期”。

## 0. 优先级说明

- P0：安全红线/线上事故级风险，必须先改
- P1：会明显影响维护效率与稳定性，尽快改
- P2：体验/性能/工程化提升，迭代改

## 1. P0（安全红线 & 合规）

| 编号 | 优先级 | 范围 | 现状问题 | 建议改法（可执行） | 参考位置 | 收益 | 工期 |
|---:|:---:|:---:|:---|:---|:---|:---|:---:|
| 1 | P0 | 前端/安全 | 前端存在明文第三方 API Key，且请求头含本地绕过标记（会被抓包直接复用） | 删除明文 Key；前端只调用后端接口；Key 放后端环境变量；后端做代理转发并做限流/鉴权 | `src/components/admin/ai/AIAssistant.vue` | 消除“密钥泄漏”红线 | S |
| 2 | P0 | 后端/安全 | 数据库账号密码明文写在配置；邮件服务密码明文写在配置 | 敏感配置全部改为环境变量/部署注入；本地开发用 `.env` 或 IDE run config；配置文件只保留占位符 | `src/main/resources/application.properties` | 消除“明文凭证”红线 | S |
| 3 | P0 | 后端/安全 | 输出详细错误与堆栈（可能泄漏内部路径/SQL/实现细节） | 生产环境关闭 `include-stacktrace/include-exception`；统一错误响应；只输出必要错误码/提示 | `application.properties` | 降低信息泄露与攻击面 | S |
| 4 | P0 | 前端/安全 | 大量 `console.log` 输出请求配置/响应（可能包含敏感数据） | 统一日志开关（按环境）；生产构建移除调试日志；将请求日志降为必要字段 | `src/utils/request.js`、`src/main.js`、`AIAssistant.vue` | 降低敏感信息暴露 | S |
| 5 | P0 | 后端/安全 | CORS 允许 credentials 且 origins 固定本地，缺少环境区分与严格化 | 按环境配置 allowed-origins；生产只允许真实域名；避免 `*` headers 过宽 | `application.properties`、`com.study.config.CorsConfig` | 降低跨站风险 | S |

## 2. P1（架构一致性 & 可维护性）

| 编号 | 优先级 | 范围 | 现状问题 | 建议改法（可执行） | 参考位置 | 收益 | 工期 |
|---:|:---:|:---:|:---|:---|:---|:---|:---:|
| 6 | P1 | 前端/工程 | 存在两套请求方式：`utils/request.js`（baseURL=/api）与全局 axios 拦截器（baseURL 为空），容易产生“双 /api”与行为不一致 | 统一只保留一套请求客户端（建议统一使用 `utils/request.js`）；逐步替换散落的 axios/fetch 调用 | `src/utils/request.js`、`src/main.js` | 降低线上接口问题与排障成本 | M |
| 7 | P1 | 前端/路由 | 路由存在重复 path（`/home` 同时注册两个 name），且守卫异常时跳转到不存在的路径（`/homefirst`） | 去重/统一 home 路由；修正兜底跳转到真实存在的路由（如 `/` 或 `/home`） | `src/router/index.js` | 降低导航异常与不可达页面 | S |
| 8 | P1 | 后端/结构 | Controller 大量放在 `com.study.service.*` 包下，层次混杂，团队协作不利 | 逐步迁移到标准分层：`controller / service / repository(or mapper) / domain(dto/entity)`；保持包命名一致 | `src/main/java/com/study/service/**` | 结构清晰，降低新同学上手成本 | L |
| 9 | P1 | 后端/稳定性 | 密码重置验证码/令牌使用进程内 Map（重启丢失、无法水平扩展） | 改为 Redis（或数据库）存储验证码/令牌；补充过期策略与限流 | `src/main/java/com/study/service/password/PasswordResetService.java` | 可扩展、可恢复、稳定性提升 | M |
|10 | P1 | 前端/可维护 | 单文件组件过大（后台主页面、AI 组件），职责过多 | 拆分为模块组件 + composables；提取公共 UI 与数据逻辑；减少 2k+ 行 SFC | `src/views/admin/admin1.vue`、`src/components/admin/ai/AIAssistant.vue` | 维护成本显著下降 | L |
|11 | P1 | 后端/一致性 | 返回结构与异常处理不统一（不同 Controller 风格不同） | 统一 API 返回格式（Result/错误码）；增加全局异常处理器；统一参数校验错误返回 | `com.study.common.Result`、各 `*Controller` | 接口更稳定，前端更好对接 | M |

## 3. P2（工程化、性能、体验）

| 编号 | 优先级 | 范围 | 现状问题 | 建议改法（可执行） | 参考位置 | 收益 | 工期 |
|---:|:---:|:---:|:---|:---|:---|:---|:---:|
|12 | P2 | 前端/质量 | 缺少 lint/typecheck/test 脚本，回归靠手测 | 引入 ESLint + Prettier（或仅 ESLint）；新增 typecheck（如有 TS 再加）；补最小单测/组件测试 | `package.json` | 质量可控，减少回归 | M |
|13 | P2 | 后端/配置 | `pom.xml` resources 排除了 `*.yml`，不利于多环境配置管理 | 放开 yml（或统一 properties）；按 profile 拆 dev/prod；敏感信息仍用 env 注入 | `pom.xml` | 部署更规范 | S |
|14 | P2 | 后端/观测 | SQL/调试日志偏多，生产可能影响性能与日志成本 | dev 开启 show-sql；prod 关闭；按环境调整 logging level | `application.properties` | 性能与成本优化 | S |
|15 | P2 | 后端/上传 | 上传目录写死到本机绝对路径，不可移植 | 改为相对路径或环境变量；支持对象存储（可选） | `application.properties`、上传相关 controller/service | 部署更方便 | S |
|16 | P2 | 前端/体验 | 将大量静态/可延迟模块提前加载 | 路由懒加载已在用，继续优化：大组件拆包、图片懒加载、避免大 JSON 打印 | `src/router/index.js`、大组件 | 首屏与交互更顺滑 | M |
|17 | P2 | 代码卫生 | `dist/`、`backup/`、本地配置等混入仓库会干扰协作 | 建议仅作为流程规范：构建产物不入库、备份文件移出仓库（不在本次修改范围） | 项目根目录 | 仓库更干净 | S |

## 4. 建议的落地顺序（最少阻力）

1. P0-1/2/3：先把“明文密钥/明文密码/错误堆栈暴露”清零  
2. P1-6/7：统一前端请求与路由，减少线上接口与跳转问题  
3. P1-9/11：让鉴权/错误/密码重置变成可扩展的“工程方案”  
4. P1-10/8：拆大组件与后端包结构重整（可并行分批做）  
5. P2：工程化与体验类按迭代推进  

